<div class="suivi-container">
  <!-- En-tête élégant -->
  <div class="header-banner">
    <div class="container">
      <div class="text-center">
        <h1 class="main-title">Suivi de Candidature</h1>
        <p class="subtitle">Consultez l'état d'avancement de votre candidature</p>
      </div>
    </div>
  </div>

  <div class="container main-content">
    <div class="search-card">
      <div class="search-form">
        <h2 class="section-title">Rechercher votre candidature</h2>
        <form (ngSubmit)="onSubmit()" class="elegant-form">
          <div class="form-group">
            <label>Numéro de CIN</label>
            <div class="input-wrapper">
              <i class="bi bi-person-badge"></i>
              <input 
                type="text" 
                [(ngModel)]="cin"
                name="cin"
                placeholder="Entrez votre CIN"
                [class.is-invalid]="error">
            </div>
          </div>
          <button type="submit" class="search-button" [disabled]="loading">
            <i class="bi bi-search"></i>
            Consulter
          </button>
        </form>
      </div>
    </div>

    <!-- Résultats avec animation -->
    <div *ngIf="candidatures?.length" class="results-section">
      <div class="results-header">
        <h3>Vos candidatures</h3>
        <span class="results-count">{{candidatures.length}} trouvée(s)</span>
      </div>
      
      <div class="results-grid">
        <div *ngFor="let candidature of candidatures" class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">{{candidature.concours?.nomConcours}}</h5>
                
                <!-- Status Badge -->
                <div class="badge" [ngClass]="{
                    'bg-warning': candidature.status === 'EN_ATTENTE',
                    'bg-success': candidature.status === 'ACCEPTE',
                    'bg-danger': candidature.status === 'REFUSE'
                }">
                    {{candidature.status}}
                </div>

                <!-- Convocation pour les candidats acceptés -->
                <div *ngIf="candidature.status === 'ACCEPTE'" class="mt-3 alert alert-success">
                    <h6 class="alert-heading">
                        <i class="bi bi-envelope-check-fill me-2"></i>
                        Convocation aux épreuves
                    </h6>
                    <hr>
                    
                    <!-- Épreuves écrites -->
                    <div *ngFor="let epreuve of candidature.concours.epreuves">
                        <div *ngIf="epreuve.typeEpreuve === 'ECRITE'" class="mb-3">
                            <h6 class="mb-2">
                                <i class="bi bi-pencil-square me-2"></i>
                                Épreuve écrite
                            </h6>
                            <p class="mb-1">
                                <strong>Date :</strong> 
                                <ng-container *ngIf="epreuve.dateEpreuve; else dateNonDefinie">
                                    {{formatDate(epreuve.dateEpreuve)}}
                                </ng-container>
                                <ng-template #dateNonDefinie>Date non définie</ng-template>
                            </p>
                            <p class="mb-1">
                                <strong>Lieu :</strong> {{epreuve.lieu || 'Non défini'}}
                            </p>
                        </div>

                        <!-- Épreuves orales -->
                        <div *ngIf="epreuve.typeEpreuve === 'ORALE'" class="mb-3">
                            <h6 class="mb-2">
                                <i class="bi bi-mic-fill me-2"></i>
                                Épreuve orale
                            </h6>
                            <p class="mb-1">
                                <strong>Date :</strong> {{epreuve.dateEpreuve | date:'dd MMMM yyyy'}}
                            </p>
                            <p class="mb-1">
                                <strong>Lieu :</strong> {{epreuve.lieu}}
                            </p>
                        </div>
                    </div>

                    <div *ngIf="candidature.status === 'ACCEPTE'" class="mt-3">
                      <button 
                        class="btn btn-success" 
                        (click)="downloadConvocation(candidature)">
                        <i class="bi bi-download me-2"></i>
                        Télécharger la convocation
                      </button>
                    </div>
                </div>

                <!-- Informations générales -->
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-calendar3 me-2"></i>
                        Date de postulation: {{candidature.datePostulation | date:'dd/MM/yyyy'}}
                    </small>
                </div>
            </div>
        </div>
      </div>
    </div>

    <!-- Loading state élégant -->
    <div *ngIf="loading" class="loader-container">
      <div class="elegant-spinner"></div>
      <p>Recherche en cours...</p>
    </div>

    <!-- Message d'erreur stylé -->
    <div *ngIf="error" class="error-message">
      <i class="bi bi-exclamation-circle"></i>
      <span>{{error}}</span>
    </div>
  </div>
</div>
